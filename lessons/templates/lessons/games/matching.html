{% extends 'lessons/base.html' %}

{% block title %}Tr√≤ ch∆°i n·ªëi ƒë√¥i - H·ªçc Ch·ªØ C√°i{% endblock %}

{% block content %}
<style>
    .game-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .game-header {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 30px;
    }

    .game-title {
        color: white;
        font-size: 32px;
        margin-bottom: 10px;
    }

    .game-board {
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
    }

    .game-stats {
        display: flex;
        justify-content: space-around;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f5f5f5;
    }

    .stat-box {
        text-align: center;
    }

    .stat-label {
        font-size: 12px;
        color: #999;
        margin-bottom: 5px;
    }

    .stat-value {
        font-size: 28px;
        font-weight: bold;
        color: #f5576c;
    }

    .matching-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        margin-bottom: 30px;
    }

    .matching-column {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .matching-item {
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-weight: 600;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        user-select: none;
    }

    .matching-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .matching-item.selected {
        background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
    }

    .matching-item.correct {
        background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
        opacity: 0.6;
        cursor: not-allowed;
    }

    .matching-item.correct:hover {
        transform: none;
    }

    .message {
        text-align: center;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        font-size: 18px;
        font-weight: 600;
    }

    .message.success {
        background: #e8f5e9;
        color: #2e7d32;
    }

    .message.error {
        background: #ffebee;
        color: #c62828;
    }

    .action-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
    }

    .btn {
        padding: 12px 30px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        font-size: 16px;
    }

    .btn-primary {
        background: #f5576c;
        color: white;
    }

    .btn-primary:hover {
        background: #e83e54;
        transform: translateY(-2px);
    }

    .btn-secondary {
        background: #999;
        color: white;
    }

    .btn-secondary:hover {
        background: #777;
        transform: translateY(-2px);
    }

    .back-btn {
        display: inline-block;
        margin-bottom: 20px;
        color: #f5576c;
        text-decoration: none;
        font-weight: 600;
    }

    .back-btn:hover {
        text-decoration: underline;
    }

    .instructions {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
        border-left: 4px solid #f5576c;
    }

    .instructions strong {
        color: #f5576c;
    }

    @media (max-width: 768px) {
        .matching-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .game-stats {
            flex-direction: column;
            gap: 15px;
        }

        .matching-column h3 {
            text-align: center;
        }
    }
</style>

<a href="{% url 'home' %}" class="back-btn">‚Üê Quay l·∫°i trang ch·ªß</a>

<div class="game-container">
    <div class="game-header">
        <div class="game-title">üîó Tr√≤ ch∆°i N·ªëi ƒë√¥i</div>
        <p>N·ªëi h√¨nh ·∫£nh v·ªõi t·ª´ ti·∫øng Vi·ªát t∆∞∆°ng ·ª©ng</p>
    </div>

    <div class="game-board">
        <div class="instructions">
            <strong>üìù H∆∞·ªõng d·∫´n:</strong> B·∫•m v√†o m·ªôt t·ª´ ·ªü b√™n tr√°i, r·ªìi b·∫•m v√†o h√¨nh ·∫£nh ho·∫∑c ƒë·ªãnh nghƒ©a ph√π h·ª£p ·ªü b√™n ph·∫£i
        </div>

        <div class="game-stats">
            <div class="stat-box">
                <div class="stat-label">C·∫∑p ƒë√∫ng</div>
                <div class="stat-value" id="correctCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">T·ªïng c·ªông</div>
                <div class="stat-value" id="totalCount">6</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Ti·∫øn ƒë·ªô</div>
                <div class="stat-value" id="progressPercent">0%</div>
            </div>
        </div>

        <div id="message" class="message" style="display: none;"></div>

        <div class="matching-grid">
            <div class="matching-column">
                <h3 style="text-align: center; color: #667eea;">T·ª´ Ti·∫øng Vi·ªát</h3>
                <div id="leftItems"></div>
            </div>
            <div class="matching-column">
                <h3 style="text-align: center; color: #667eea;">Nghƒ©a / H√¨nh ·∫£nh</h3>
                <div id="rightItems"></div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="resetGame()">üîÑ Ch∆°i l·∫°i</button>
            <a href="{% url 'home' %}" class="btn btn-secondary">‚Üê Trang ch·ªß</a>
        </div>
    </div>
</div>

<script>
    const pairs = [
        { left: 'Con M√®o', right: 'üê± M·ªôt ƒë·ªông v·∫≠t nu√¥i' },
        { left: 'Con Ch√≥', right: 'üê∂ B·∫°n th√¢n thi·∫øt c·ªßa con ng∆∞·ªùi' },
        { left: 'Qu·∫£ T√°o', right: 'üçé Tr√°i c√¢y ƒë·ªè ng·ªçt' },
        { left: 'Ng√¥i Nh√†', right: 'üè† N∆°i ·ªü c·ªßa con ng∆∞·ªùi' },
        { left: 'Xe √î T√¥', right: 'üöó Ph∆∞∆°ng ti·ªán giao th√¥ng' },
        { left: 'Con Chim', right: 'üê¶ ƒê·ªông v·∫≠t c√≥ c√°nh v√† l√¥ng' }
    ];

    let matched = [];
    let selected = null;

    function initGame() {
        matched = [];
        selected = null;

        // Shuffle right items
        let rightItems = pairs.map(p => p.right);
        rightItems = rightItems.sort(() => Math.random() - 0.5);

        // Create left items
        let leftContainer = document.getElementById('leftItems');
        leftContainer.innerHTML = '';
        pairs.forEach((pair, index) => {
            let item = document.createElement('div');
            item.className = 'matching-item';
            item.textContent = pair.left;
            item.dataset.index = index;
            item.onclick = () => selectLeft(index, item);
            leftContainer.appendChild(item);
        });

        // Create right items
        let rightContainer = document.getElementById('rightItems');
        rightContainer.innerHTML = '';
        rightItems.forEach((right, index) => {
            let item = document.createElement('div');
            item.className = 'matching-item';
            item.textContent = right;
            item.dataset.value = right;
            item.onclick = () => selectRight(right, item);
            rightContainer.appendChild(item);
        });

        updateStats();
        document.getElementById('message').style.display = 'none';
    }

    function selectLeft(index, element) {
        if (matched.includes(index)) return;
        
        // Remove previous selection
        document.querySelectorAll('#leftItems .matching-item.selected').forEach(el => {
            el.classList.remove('selected');
        });

        if (selected === index) {
            selected = null;
        } else {
            selected = index;
            element.classList.add('selected');
        }
    }

    function selectRight(rightValue, element) {
        if (!selected !== null && pairs[selected].right === rightValue) {
            matched.push(selected);
            
            document.querySelector(`#leftItems .matching-item[data-index="${selected}"]`).classList.add('correct');
            element.classList.add('correct');
            
            selected = null;
            updateStats();

            if (matched.length === pairs.length) {
                showMessage('Ch√∫c m·ª´ng! B·∫°n n·ªëi ƒë√∫ng t·∫•t c·∫£! üéâ', 'success');
            }
        } else if (selected !== null) {
            showMessage('Sai r·ªìi! Th·ª≠ l·∫°i nha! ‚ùå', 'error');
            selected = null;
            document.querySelectorAll('#leftItems .matching-item.selected').forEach(el => {
                el.classList.remove('selected');
            });
        }
    }

    function updateStats() {
        document.getElementById('correctCount').textContent = matched.length;
        document.getElementById('totalCount').textContent = pairs.length;
        let percent = Math.round((matched.length / pairs.length) * 100);
        document.getElementById('progressPercent').textContent = percent + '%';
    }

    function showMessage(msg, type) {
        let messageEl = document.getElementById('message');
        messageEl.textContent = msg;
        messageEl.className = 'message ' + type;
        messageEl.style.display = 'block';
        setTimeout(() => {
            messageEl.style.display = 'none';
        }, 2000);
    }

    function resetGame() {
        initGame();
    }

    // Start game
    initGame();
</script>

{% endblock %}
